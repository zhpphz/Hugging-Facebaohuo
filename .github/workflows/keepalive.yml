name: Keepalive All Hugging Face Spaces
on:
  schedule:
    - cron: "15 8,5,15 * * *"  # åŒ—äº¬æ—¶é—´ 9:20, 13:20, 23:20
  workflow_dispatch:
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Ping Spaces å’Œ notify via WxPusher
        run: |
          # ğŸ”´ğŸ”´ğŸ”´ é«˜å±ï¼ä»¥ä¸‹Tokenå’ŒUIDä¼šå…¬å¼€æš´éœ²ï¼ğŸ”´ğŸ”´ğŸ”´
          WXP_TOKEN="AT_8W0HaJDqsTjYPxgsyCdg5xxGU58e7a9q"  # æ›¿æ¢ä¸ºä½ çš„Token
          WXP_UID="UID_pT7ifPmHs5ewHZcNXE9saeXCCopf"    # æ›¿æ¢ä¸ºä½ çš„UID

          failed_urls=""
          all_success=true  # é»˜è®¤å‡è®¾å…¨éƒ¨æˆåŠŸ

          while IFS= read -r url; do
            status_code=$(curl -s -o /dev/null -w "%{http_code}" "$url")
            
            if [ "$status_code" -ne 200 ]; then
              failed_urls+="âŒ $url (çŠ¶æ€ç : $status_code)\n"
              all_success=false  # æ ‡è®°å­˜åœ¨å¤±è´¥
              echo "::warning::URL è®¿é—®å¤±è´¥: $url | çŠ¶æ€ç : $status_code"
            else
              echo "URL: $url | çŠ¶æ€ç : $status_code"
            fi
            sleep 0.3
          done < urls.txt

          # æ ¹æ®æƒ…å†µå‘é€ä¸åŒé€šçŸ¥
          if [ "$all_success" = true ]; then
            # å…¨éƒ¨200æ—¶å‘é€æˆåŠŸé€šçŸ¥
            curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
              -H "Content-Type: application/json" \
              -d '{
                "appToken": "'"$WXP_TOKEN"'",
                "content": "âœ… Hugging-Face æ‰€æœ‰é“¾æ¥æ­£å¸¸",
                "contentType": 1,
                "uids": ["'"$WXP_UID"'"]
              }'
            echo "å·²æ¨é€æˆåŠŸé€šçŸ¥"
          elif [ -n "$failed_urls" ]; then
            # å­˜åœ¨å¤±è´¥æ—¶å‘é€å¼‚å¸¸é€šçŸ¥
            curl -s -X POST "https://wxpusher.zjiecode.com/api/send/message" \
              -H "Content-Type: application/json" \
              -d '{
                "appToken": "'"$WXP_TOKEN"'",
                "content": "âš ï¸ Hugging-Face å¼‚å¸¸å‘Šè­¦\n\n'"$failed_urls"'",
                "contentType": 1,
                "uids": ["'"$WXP_UID"'"]
              }'
            echo "å·²æ¨é€å¼‚å¸¸å‘Šè­¦"
          fi
